<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USD to EUR Exchange Rate</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #f4f4f4;
      text-align: center;
    }
    #rate {
      font-size: 1.8em;
      color: #007bff;
    }
    #error {
      color: red;
      margin-top: 10px;
    }
    #converter {
      margin-top: 20px;
    }
    input[type="number"] {
      padding: 8px;
      font-size: 1em;
      width: 150px;
    }
    #converted {
      font-size: 1.4em;
      margin-top: 10px;
      color: #28a745;
    }
    canvas {
      max-width: 100%;
      margin-top: 40px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 5px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>USD to EUR Exchange Rate</h1>
<div id="rate">Loading current rate...</div>
<div id="error"></div>

<div id="converter">
  <p>Enter USD Amount:</p>
  <input type="number" id="usdInput" placeholder="e.g. 100" min="0" step="0.01">
  <div id="converted"></div>
</div>

<canvas id="rateChart" width="800" height="400"></canvas>
<button id="refreshBtn">Refresh</button>

<script>
  const rateDiv = document.getElementById("rate");
  const errorDiv = document.getElementById("error");
  const usdInput = document.getElementById("usdInput");
  const convertedDiv = document.getElementById("converted");
  const ctx = document.getElementById("rateChart").getContext("2d");

  let chart;
  let currentRate = null;

  async function fetchCurrentRate() {
    try {
      const res = await fetch("https://api.frankfurter.app/latest?from=USD&to=EUR");
      if (!res.ok) throw new Error(`HTTP error ${res.status}`);
      const data = await res.json();
      currentRate = data.rates.EUR;
      rateDiv.textContent = `1 USD = ${currentRate.toFixed(4)} EUR (as of ${data.date})`;
    } catch (err) {
      rateDiv.textContent = "";
      errorDiv.textContent = "Error fetching current rate: " + err.message;
      console.error(err);
    }
  }

  async function fetchHistoryAndDrawChart() {
    try {
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setDate(today.getDate() - 365);
      const startDate = oneYearAgo.toISOString().split("T")[0];
      const endDate = today.toISOString().split("T")[0];

      const url = `https://api.frankfurter.app/${startDate}..${endDate}?from=USD&to=EUR`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP error ${res.status}`);
      const data = await res.json();

      const dates = Object.keys(data.rates).sort();
      const values = dates.map(d => data.rates[d].EUR);

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'USD to EUR',
            data: values,
            borderColor: '#007bff',
            backgroundColor: 'rgba(0,123,255,0.1)',
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false,
            },
          },
          scales: {
            x: {
              ticks: {
                maxTicksLimit: 12,
              }
            },
            y: {
              title: {
                display: true,
                text: "EUR"
              }
            }
          }
        }
      });
    } catch (err) {
      errorDiv.textContent = "Error fetching history: " + err.message;
      console.error(err);
    }
  }

  async function refreshAll() {
    errorDiv.textContent = "";
    rateDiv.textContent = "Loading current rate...";
    convertedDiv.textContent = "";
    await fetchCurrentRate();
    await fetchHistoryAndDrawChart();
  }

  usdInput.addEventListener("input", () => {
    const usd = parseFloat(usdInput.value);
    if (!isNaN(usd) && currentRate !== null) {
      const eur = usd * currentRate;
      convertedDiv.textContent = `${usd.toFixed(2)} USD â‰ˆ ${eur.toFixed(2)} EUR`;
    } else {
      convertedDiv.textContent = "";
    }
  });

  document.getElementById("refreshBtn").addEventListener("click", refreshAll);

  // Initial load
  refreshAll();
</script>

</body>
</html>
